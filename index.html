<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Dashle</title>
    <link rel="apple-touch-icon" href="Dashle.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        :root { 
            --correct: #6aaa64; --present: #c9b458; --absent: #787c7e; 
            --tile-border: #d3d6da; --accent: #007AFF; 
            --bg: #ffffff; --text: #000000; --header-bg: #ffffff;
            --key-bg: #d3d6da; --key-text: #000000; --control-bg: #f9f9f9;
        }

        [data-theme="dark"] {
            --bg: #121213; --text: #ffffff; --header-bg: #121213;
            --tile-border: #3a3a3c; --key-bg: #818384; --key-text: #ffffff;
            --control-bg: #1a1a1b; --absent: #3a3a3c;
        }
        
        html, body { width: 100%; margin: 0; padding: 0; background: var(--bg); color: var(--text); -webkit-text-size-adjust: 100%; overflow-x: hidden; }
        body { font-family: -apple-system, sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        
        header { 
            width: 100%; border-bottom: 1px solid var(--tile-border); text-align: center; 
            padding: calc(10px + env(safe-area-inset-top)) 0 10px 0; 
            font-weight: 800; font-size: 20px; background: var(--header-bg); flex-shrink: 0; 
            display: flex; justify-content: space-between; align-items: center;
        }
        header span { flex: 1; margin-left: 40px; }

        #theme-toggle { margin-right: 15px; cursor: pointer; font-size: 20px; background: none; border: none; }

        .controls { 
            display: flex; flex-direction: column; align-items: center;
            gap: 8px; padding: 10px; background: var(--control-bg); width: 100%; 
            border-bottom: 1px solid var(--tile-border); flex-shrink: 0;
        }

        .input-row { display: flex; gap: 10px; justify-content: center; width: 100%; }
        .control-group { display: flex; align-items: center; gap: 5px; }
        .control-group label { font-size: 11px; font-weight: bold; color: var(--absent); text-transform: uppercase; }

        .box-style {
            height: 38px !important; width: 85px !important; border-radius: 8px; 
            border: 1px solid var(--tile-border); font-size: 14px; 
            background: var(--bg); color: var(--text); text-align: center; -webkit-appearance: none;
        }
        
        button#new-game-btn {
            background: var(--accent); color: white; border: none; height: 38px;
            border-radius: 8px; font-size: 14px; font-weight: bold; width: 160px;
        }

        #game-container { display: flex; flex-direction: column; align-items: center; width: 100%; padding-top: 15px; }
        #board { display: grid; gap: 6px; padding-bottom: 20px; }
        
        .tile {
            width: 50px; height: 50px; border: 2px solid var(--tile-border);
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; font-weight: bold; text-transform: uppercase;
        }

        .correct { background: var(--correct) !important; color: white !important; border-color: var(--correct) !important; }
        .present { background: var(--present) !important; color: white !important; border-color: var(--present) !important; }
        .absent { background: var(--absent) !important; color: white !important; border-color: var(--absent) !important; }

        .message { font-size: 16px; font-weight: 700; height: 20px; margin-bottom: 10px; text-align: center; }

        #keyboard { margin-top: auto; padding: 0 8px 30px 8px; width: 100%; max-width: 500px; }
        .keyboard-row { display: flex; justify-content: center; gap: 4px; margin-bottom: 8px; }
        .key { 
            height: 58px; flex: 1; border: none; border-radius: 4px; 
            background: var(--key-bg); font-weight: bold; font-size: 14px; 
            display: flex; align-items: center; justify-content: center; 
            color: var(--key-text); cursor: pointer; -webkit-tap-highlight-color: transparent;
        }
        .spacer { flex: 0.5; }
        .wide-key { flex: 1.5; font-size: 11px; }
    </style>
</head>
<body>

    <header>
        <span>DASHLE</span>
        <button id="theme-toggle" onclick="toggleTheme()">ðŸŒ™</button>
    </header>
    
    <div class="controls">
        <div class="input-row">
            <div class="control-group">
                <label>Len</label>
                <select id="lenSelect" class="box-style"></select>
            </div>
            <div class="control-group">
                <label>Try</label>
                <select id="guessSelect" class="box-style">
                    <option value="1">1</option><option value="2">2</option><option value="3">3</option>
                    <option value="4">4</option><option value="5">5</option><option value="6" selected>6</option>
                    <option value="1000">Unlimited</option>
                </select>
            </div>
        </div>
        <button id="new-game-btn" onclick="resetGame()">NEW GAME</button>
    </div>

    <div id="game-container">
        <div class="message" id="message"></div>
        <div id="board"></div>
    </div>

    <div id="keyboard">
        <div class="keyboard-row">
            <button class="key" data-key="Q">Q</button><button class="key" data-key="W">W</button>
            <button class="key" data-key="E">E</button><button class="key" data-key="R">R</button>
            <button class="key" data-key="T">T</button><button class="key" data-key="Y">Y</button>
            <button class="key" data-key="U">U</button><button class="key" data-key="I">I</button>
            <button class="key" data-key="O">O</button><button class="key" data-key="P">P</button>
        </div>
        <div class="keyboard-row">
            <div class="spacer"></div>
            <button class="key" data-key="A">A</button><button class="key" data-key="S">S</button>
            <button class="key" data-key="D">D</button><button class="key" data-key="F">F</button>
            <button class="key" data-key="G">G</button><button class="key" data-key="H">H</button>
            <button class="key" data-key="J">J</button><button class="key" data-key="K">K</button>
            <button class="key" data-key="L">L</button>
            <div class="spacer"></div>
        </div>
        <div class="keyboard-row">
            <button class="key wide-key" data-key="ENTER">ENTER</button>
            <button class="key" data-key="Z">Z</button><button class="key" data-key="X">X</button>
            <button class="key" data-key="C">C</button><button class="key" data-key="V">V</button>
            <button class="key" data-key="B">B</button><button class="key" data-key="N">N</button>
            <button class="key" data-key="M">M</button>
            <button class="key wide-key" data-key="BACKSPACE">âŒ«</button>
        </div>
    </div>

    <script>
        let ALL_DATA = {};
        let WORD_LENGTH = 5;
        let MAX_GUESSES = 6;
        let targetWord = "";
        let guesses = [];
        let currentGuess = "";
        let gameOver = false;
        let currentValidList = [];

        function toggleTheme() {
            const body = document.body;
            const btn = document.getElementById('theme-toggle');
            if (body.hasAttribute('data-theme')) {
                body.removeAttribute('data-theme');
                btn.textContent = "ðŸŒ™";
            } else {
                body.setAttribute('data-theme', 'dark');
                btn.textContent = "â˜€ï¸";
            }
        }

        async function loadData() {
            try {
                const response = await fetch('word_lists/lengths.txt');
                const text = await response.text();
                const lengths = text.split(',').map(n => n.trim()).sort((a, b) => a - b);
                const selector = document.getElementById('lenSelect');
                selector.innerHTML = "";
                lengths.forEach(len => {
                    let opt = document.createElement('option');
                    opt.value = len; opt.textContent = len;
                    if(len == "5") opt.selected = true;
                    selector.appendChild(opt);
                });
                initKeyboardListeners();
                resetGame();
            } catch (e) {
                document.getElementById('message').textContent = "Manifest Error";
            }
        }

        async function resetGame() {
            WORD_LENGTH = parseInt(document.getElementById('lenSelect').value) || 5;
            MAX_GUESSES = parseInt(document.getElementById('guessSelect').value) || 6;
            
            if (!ALL_DATA[WORD_LENGTH]) {
                document.getElementById('message').textContent = "Loading words...";
                try {
                    const [ansRes, gueRes] = await Promise.all([
                        fetch(`word_lists/answer_list_${WORD_LENGTH}.txt`),
                        fetch(`word_lists/guess_list_${WORD_LENGTH}.txt`)
                    ]);
                    const ansText = await ansRes.text();
                    const gueText = await gueRes.text();
                    ALL_DATA[WORD_LENGTH] = {
                        answers: ansText.split(/\r?\n/).map(w => w.trim().toUpperCase()).filter(w => w.length === WORD_LENGTH),
                        valid: [...new Set([...ansText.split(/\r?\n/), ...gueText.split(/\r?\n/)])].map(w => w.trim().toUpperCase()).filter(w => w.length === WORD_LENGTH)
                    };
                } catch (e) {
                    document.getElementById('message').textContent = "Load Error";
                    return;
                }
            }

            targetWord = ALL_DATA[WORD_LENGTH].answers[Math.floor(Math.random() * ALL_DATA[WORD_LENGTH].answers.length)];
            currentValidList = ALL_DATA[WORD_LENGTH].valid;
            guesses = [];
            currentGuess = "";
            gameOver = false;
            document.getElementById('message').textContent = "";
            document.querySelectorAll('.key').forEach(k => k.className = 'key' + (k.classList.contains('wide-key') ? ' wide-key' : ''));
            initBoard();
        }

        function initBoard() {
            const board = document.getElementById('board');
            board.innerHTML = "";
            const tileSize = WORD_LENGTH > 6 ? 42 : 50;
            board.style.gridTemplateColumns = `repeat(${WORD_LENGTH}, ${tileSize}px)`;
            let rows = MAX_GUESSES === 1000 ? 1 : MAX_GUESSES;
            for (let i = 0; i < rows * WORD_LENGTH; i++) {
                const tile = document.createElement('div');
                tile.className = 'tile';
                tile.style.width = tileSize + 'px'; tile.style.height = tileSize + 'px';
                tile.id = 'tile-' + i;
                board.appendChild(tile);
            }
            updateBoard();
            window.scrollTo(0, 0);
        }

        function updateBoard() {
            const board = document.getElementById('board');
            const tileSize = WORD_LENGTH > 6 ? 42 : 50;

            if (MAX_GUESSES === 1000) {
                while (board.children.length < (guesses.length + 1) * WORD_LENGTH) {
                    const tile = document.createElement('div');
                    tile.className = 'tile';
                    tile.style.width = tileSize + 'px'; tile.style.height = tileSize + 'px';
                    tile.id = 'tile-' + board.children.length;
                    board.appendChild(tile);
                }
            }

            const keyStates = {};

            for (let i = 0; i < (MAX_GUESSES === 1000 ? guesses.length + 1 : MAX_GUESSES); i++) {
                const guess = guesses[i];
                if (guess) {
                    let targetLetters = targetWord.split('');
                    let statuses = Array(WORD_LENGTH).fill('absent');
                    
                    for (let j = 0; j < WORD_LENGTH; j++) {
                        if (guess[j] === targetWord[j]) {
                            statuses[j] = 'correct';
                            targetLetters[j] = null;
                            keyStates[guess[j]] = 'correct';
                        }
                    }
                    for (let j = 0; j < WORD_LENGTH; j++) {
                        if (statuses[j] === 'absent' && targetLetters.includes(guess[j])) {
                            statuses[j] = 'present';
                            targetLetters[targetLetters.indexOf(guess[j])] = null;
                            if (keyStates[guess[j]] !== 'correct') keyStates[guess[j]] = 'present';
                        } else if (statuses[j] === 'absent') {
                            if (!keyStates[guess[j]]) keyStates[guess[j]] = 'absent';
                        }
                    }
                    for (let j = 0; j < WORD_LENGTH; j++) {
                        const tile = document.getElementById('tile-' + (i * WORD_LENGTH + j));
                        tile.textContent = guess[j];
                        tile.className = 'tile ' + statuses[j];
                    }
                } else if (i === guesses.length) {
                    for (let j = 0; j < WORD_LENGTH; j++) {
                        const tile = document.getElementById('tile-' + (i * WORD_LENGTH + j));
                        if(tile) { tile.textContent = currentGuess[j] || ""; tile.className = 'tile'; }
                    }
                }
            }

            for (const [letter, status] of Object.entries(keyStates)) {
                const keyEl = document.querySelector(`.key[data-key="${letter}"]`);
                if (keyEl) {
                    if (status === 'correct') { keyEl.classList.remove('present', 'absent'); keyEl.classList.add('correct'); }
                    else if (status === 'present' && !keyEl.classList.contains('correct')) { keyEl.classList.remove('absent'); keyEl.classList.add('present'); }
                    else if (status === 'absent' && !keyEl.classList.contains('correct') && !keyEl.classList.contains('present')) { keyEl.classList.add('absent'); }
                }
            }
        }

        function handleInput(key) {
            if (gameOver) return;
            if (key === 'ENTER') {
                if (currentGuess.length !== WORD_LENGTH) return;
                if (!currentValidList.includes(currentGuess)) {
                    document.getElementById('message').textContent = "Invalid Word";
                    setTimeout(() => { if(!gameOver) document.getElementById('message').textContent = ""; }, 2000);
                    return;
                }
                guesses.push(currentGuess);
                if (currentGuess === targetWord) { document.getElementById('message').textContent = "You got it! ðŸŽ‰"; gameOver = true; }
                else if (guesses.length === MAX_GUESSES) { document.getElementById('message').textContent = "Word: " + targetWord; gameOver = true; }
                currentGuess = "";
                updateBoard();
                setTimeout(() => {
                    const nextRow = document.getElementById('tile-' + (guesses.length * WORD_LENGTH));
                    if (nextRow) nextRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            } else if (key === 'BACKSPACE') {
                currentGuess = currentGuess.slice(0, -1);
                updateBoard();
            } else if (currentGuess.length < WORD_LENGTH && /^[A-Z]$/.test(key)) {
                currentGuess += key;
                updateBoard();
            }
        }

        function initKeyboardListeners() {
            document.querySelectorAll('.key').forEach(key => {
                key.addEventListener('click', () => handleInput(key.getAttribute('data-key')));
            });
            document.addEventListener('keydown', (e) => {
                let key = e.key.toUpperCase();
                if (key === 'BACKSPACE' || key === 'ENTER' || /^[A-Z]$/.test(key)) handleInput(key);
            });
        }

        loadData();
    </script>
</body>
</html>
